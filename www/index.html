<!DOCTYPE html>
<html>
  <head>
    <title>demo</title>

    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
  </head>
  <body>
  <font size=7 color=blue>
  log2: <p>
  <p id="log"></p>
  </font>
  </body>

<script type="text/javascript" charset="utf-8">
young_log("init00");
document.addEventListener('deviceready', onDeviceReady, false);
young_log("init01");
function onDeviceReady() {
	young_log("init1");
	young_log("init2");
	young_log("init3");
	young_log("init4");
	foo();
}

function young_log(message)
{
	document.getElementById("log").innerHTML += (message + "<p>");
}	
//---------------------------
function foo()
{
  young_log("init5");
  var zip = require('org.chromium.zip.Zip');
  young_log("init6");
  var fileUrl = null;
  var dirUrl = null;

  young_log("init7");
  window.requestFileSystem  = window.requestFileSystem || window.webkitRequestFileSystem;
  var xhr = new XMLHttpRequest();
  xhr.open('GET', 'http://archive.apache.org/dist/cordova/cordova-2.9.1-src.zip', true);
  xhr.responseType = 'blob';
  xhr.onerror = onError;
  xhr.onload = function(e) {
          window.requestFileSystem(PERSISTENT, 1024 * 1024, function(fs) {
            fs.root.getFile('cordova-2.9.1-src.zip', {create: true}, function(fileEntry) {
            fileEntry.createWriter(function(writer) {

            writer.onwrite = done;
            writer.onerror = onError;

            var blob = new Blob([xhr.response]);
            writer.write(blob);
                fileUrl = fileEntry.toURL();
              }, onError);
            }, onError);

            fs.root.getDirectory('zipOutput', {create: true}, function(fileEntry) {
              dirUrl = fileEntry.toURL();
            }, onError);
          }, onError);
        };
  xhr.send();
  zip.unzip(fileUrl, dirUrl, done, function(progressEvent) {
          progress = progressEvent.loaded / progressEvent.total;
          young_log("progress:"+progress);});

	function onError(error) {
		young_log( "fail");
        young_log( "error code:"+ error.code);
        }	
  
    function done (a) { young_log("onwrite");}		  
}


    </script>
 
</html>
